{% extends "layout.html" %}

{% comment %} {% block title %}
    ONE AN ECOMMERCE PLATFORM - Posts List
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-5">
        <a href="{% url 'one:create' %}" class="btn btn-warning btn-lg px-4 rounded-pill shadow-lg hover-transform gradient-btn">
            <i class="bi bi-plus-circle-fill me-2"></i>Create Post
        </a>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for post in posts %}
        <div class="col">
            <div class="card h-650px border-0 shadow-sm overflow-hidden transition-all hover-lift">
                <!-- Image Section -->
                <div class="card-img-top position-relative ratio ratio-4x3 ">
                    <img src="{% if post.photo %}{{ post.photo.url }}{% else %}/static/images/default-image.jpg{% endif %}" 
                         class="object-fit-cover"
                         alt="Post Image"
                         loading="lazy"
                         style="transition: transform 0.3s ease; ">
                   
                </div>
                <span class="badge bg-success bg-gradient position-absolute top-0 end-0 m-2 shadow-sm">
                    Available: {{ post.quantity }}
                </span>

                <!-- Card Body -->
                <div class="card-body d-flex flex-column p-3">
                    <!-- User Info -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0">
                            <a href="{% url 'one:user_posts' post.user.username %}" 
                               class="text-decoration-none text-dark fw-bold hover-primary">
                                @{{ post.user.username }}
                            </a>
                        </h5>
                        <small class="text-muted">{{ post.created_at|timesince }} ago</small>
                    </div>

                    <!-- Post Content -->
                    <p class="card-text text-muted mb-4 line-clamp-3" style="flex-grow: 1;">
                        {{ post.text }}
                    </p>

                    <!-- Action Buttons -->
                    <div class="mt-auto">
                        {% if post.user == user %}
                        <div class="d-flex gap-2">
                            <a href="{% url 'one:edit' post.id %}" 
                               class="btn btn-outline-primary btn-sm rounded-pill flex-grow-1 shadow-sm hover-transform">
                                <i class="bi bi-pencil-square me-2"></i>Edit
                            </a>
                            <a href="{% url 'one:delete' post.id %}" 
                               class="btn btn-outline-danger btn-sm rounded-pill flex-grow-1 shadow-sm hover-transform">
                                <i class="bi bi-trash me-2"></i>Delete
                            </a>
                        </div>
                        {% else %}
                            {% if user.is_authenticated %}
                            <form method="POST" action="{% url 'one:addtocart' post.id user.username %}">
                                {% csrf_token %}
                                <div class="row g-2 align-items-center mb-3">
                                    <div class="col-12">
                                        <div class="input-group input-group-sm border rounded-pill bg-light">
                                            <span class="input-group-text bg-transparent border-0 small">Qty</span>
                                            <input type="number" 
                                                   name="quantity" 
                                                   id="quantity" 
                                                   value="1" 
                                                   min="1"
                                                   class="form-control border-0 bg-transparent text-center"
                                                   style="max-width: 70px;">
                                            <span class="input-group-text bg-transparent border-0 small text-muted">
                                                Stock: {{ post.quantity }}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="h5 text-primary mb-0">
                                                ₨{{ post.price }}
                                            </span>
                                            <button type="submit" 
                                                    class="btn btn-warning btn-sm rounded-pill shadow-sm hover-transform gradient-hover">
                                                <i class="bi bi-cart-plus me-2"></i>Add to Cart
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            {% else %}
                            <a href="{% url 'login' %}?next={{ request.path }}" 
                               class="btn btn-warning w-100 rounded-pill shadow-sm hover-transform gradient-hover">
                                <i class="bi bi-box-arrow-in-right me-2"></i>Login to Purchase
                            </a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    /* Enhanced Styles */
    .card {
        border-radius: 20px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .hover-lift:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25)!important;
    }
    
    .object-fit-cover {
        object-fit: cover;
        object-position: center center;
    }
    
    .hover-transform {
        transition: all 0.2s ease;
    }
    
    .hover-transform:hover {
        transform: translateY(-2px);
    }
    
    .gradient-hover {
        background: linear-gradient(135deg, #ffc107 0%, #ff6b00 100%);
        border: none;
        color: white !important;
    }
    
    .gradient-hover:hover {
        background: linear-gradient(135deg, #ff6b00 0%, #ffc107 100%);
    }
    
    .gradient-btn {
        background: linear-gradient(135deg, #ffc107 0%, #ff6b00 100%);
        border: none;
        color: white !important;
    }
    
    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .hover-primary:hover {
        color: #ff6b00 !important;
        transition: color 0.3s ease;
    }
    
    .card-img-top {
        border-radius: 20px 20px 0 0;
        transition: transform 0.3s ease;
    }
    
    .card:hover .card-img-top {
        transform: scale(1.1);
    }
    
    .ratio-4x3::before {
        padding-top: 75%;
    }
</style>
{% endblock %} {% endcomment %}


{% comment %} {% block title %}
    ONE AN ECOMMERCE PLATFORM - Posts List
{% endblock %}

{% block content %}
<div class="content-center">
<div class="text-center">
    <a type="button" class="btn btn-outline-warning mb-4 mt-4" href="{% url 'one:create' %}">Creat Post</a>
</div>


<div class="container d-flex flex-wrap justify-content-center gap-3">
    
       {% for post in posts %}
    <div class="card" style="width: 18rem; height: 600px;">
        <img src="{% if post.photo %}{{ post.photo.url }}{% else %}/static/images/default-image.jpg{% endif %}" 
             class="card-img-top img-fluid" style="height: 300px; object-fit: cover;" alt="Post Image">

        <div class="card-body">
            <h5 class="card-title "style="text-decoration-none">
                <a href="{% url 'one:user_posts' post.user.username %}" class="no-underline">{{ post.user.username }}</a>
            </h5>
            <p class="card-text">{{ post.text }}</p>
            {% if post.user == user %}
            <a href="{% url 'one:edit' post.id %}" class="btn btn-primary">Edit</a>
            <a href="{% url 'one:delete' post.id %}" class="btn btn-danger">Delete</a>
            {% else %}
            {% if user.is_authenticated %}
            <form method="POST" action="{% url 'one:addtocart' post.id user.username %}">
                {% csrf_token %} 
                <label for="quantity">Quantity:</label>
                <input class="form-control w-25 p-2"type="number" name="quantity" id="quantity" value="1" min="1">
                <p><strong>Quantity AVAILABLE:</strong> {{ post.quantity }}</p>
                <p><strong>Price:</strong> {{ post.price }}pkr</p>
                <button type="submit"class="btn btn-warning button-control mt-2">Add to Cart</button>
            </form>
            {% else %}
                <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-warning">Login to Cart</a>
            {% endif %}
       
            {% endif %}
        </div>
    </div>
{% endfor %}
    </div>
</div>
    

{% endblock %}
  {% endcomment %}
{% block title %}
  ONE AN ECOMMERCE PLATFORM - Posts List
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="text-center mb-5">
      <a href="{% url 'one:create' %}" class="btn btn-warning btn-lg px-4 rounded-pill shadow-lg hover-transform gradient-btn">
          <i class="bi bi-plus-circle-fill me-2"></i>Create Post
      </a>
  </div>

  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      {% for post in posts %}
      <div class="col">
          <div class="card h-650px w-16 rem border-0 shadow-sm overflow-hidden transition-all hover-lift">
              <!-- Image Section -->
              <div class="card-img-top position-relative ">
                  <img src="{% if post.photo %}{{ post.photo.url }}{% else %}/static/images/default-image.jpg{% endif %}" 
                       class="object-fit-cover"
                       alt="Post Image"
                       loading="lazy"
                       style="height: 500px; width: 100%;" 
                       style="transition: transform 0.3s ease;">
                  
              </div>
              <span class="badge bg-success bg-gradient position-absolute top-0 end-0 m-2 shadow-sm">
                {{ post.quantity }} Available
            </span>

              <!-- Card Body -->
              <div class="card-body d-flex flex-column p-3">
                  <!-- User Info -->
                  <h5 class="card-title mb-3">
                      <a href="{% url 'one:user_posts' post.user.username %}" 
                         class="text-decoration-none text-dark fw-bold hover-primary">
                          @{{ post.user.username }}
                      </a>
                  </h5>

                  <!-- Post Content -->
                  <p class="card-text text-muted line-clamp-3 mb-4" style="flex-grow: 1;">
                      {{ post.text }}
                  </p>

                  <!-- Action Buttons -->
                  <div class="mt-auto">
                      {% if post.user == user %}
                      <div class="d-flex gap-2">
                          <a href="{% url 'one:edit' post.id %}" 
                             class="btn btn-outline-primary btn-sm rounded-pill flex-grow-1 shadow-sm hover-transform">
                              <i class="bi bi-pencil-square me-2"></i>Edit
                          </a>
                          <a href="{% url 'one:delete' post.id %}" 
                             class="btn btn-outline-danger btn-sm rounded-pill flex-grow-1 shadow-sm hover-transform">
                              <i class="bi bi-trash me-2"></i>Delete
                          </a>
                      </div>
                      {% else %}
                          {% if user.is_authenticated %}
                          <form method="POST" action="{% url 'one:addtocart' post.id user.username %}">
                              {% csrf_token %}
                              <div class="row g-2 align-items-center mb-3">
                                  <div class="col-12">
                                      <div class="input-group input-group-sm border rounded-pill bg-light">
                                          <span class="input-group-text bg-transparent border-0 small">Qty</span>
                                          <input type="number" 
                                                 name="quantity" 
                                                 id="quantity" 
                                                 value="1" 
                                                 min="1"
                                                 class="form-control border-0 bg-transparent text-center"
                                                 style="max-width: 70px;">
                                          <span class="input-group-text bg-transparent border-0 small text-muted">
                                              Stock: {{ post.quantity }}
                                          </span>
                                      </div>
                                  </div>
                                  <div class="col-12">
                                      <div class="d-flex justify-content-between align-items-center">
                                          <span class="h5 text-primary mb-0">
                                              ₨{{ post.price }}
                                          </span>
                                          <button type="submit" 
                                                  class="btn btn-warning btn-sm rounded-pill shadow-sm hover-transform gradient-hover">
                                              <i class="bi bi-cart-plus me-2"></i>Add to Cart
                                          </button>
                                      </div>
                                  </div>
                              </div>
                          </form>
                          {% else %}
                          <a href="{% url 'login' %}?next={{ request.path }}" 
                             class="btn btn-warning w-100 rounded-pill shadow-sm hover-transform gradient-hover">
                              <i class="bi bi-box-arrow-in-right me-2"></i>Login to Purchase
                          </a>
                          {% endif %}
                      {% endif %}
                  </div>
              </div>
          </div>
      </div>
      {% endfor %}
  </div>
</div>

<!-- Keep the same CSS styles from previous version -->
<style>
  .hover-lift { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 1rem; }
  .hover-lift:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25)!important; }
  .object-fit-cover { object-fit: cover; object-position: center center; }
  .hover-transform { transition: all 0.2s ease; }
  .hover-transform:hover { transform: translateY(-2px); }
  .gradient-hover { background: linear-gradient(135deg, #ffc107 0%, #ff6b00 100%); border: none; color: white !important; }
  .gradient-btn { background: linear-gradient(135deg, #ffc107 0%, #ff6b00 100%); border: none; color: white !important; }
  .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
  .hover-primary:hover { color: #ff6b00 !important; transition: color 0.3s ease; }
  .card-img-top { border-radius: 20px 20px 0 0; transition: transform 0.3s ease; }
  .card:hover .card-img-top { transform: scale(1.03); }
  .ratio-4x3::before { padding-top: 75%; }
</style>
{% endblock %}